## Licensed to Marvelution under one or more contributor license
## agreements.  See the NOTICE file distributed with this work
## for additional information regarding copyright ownership.
## Marvelution licenses this file to you under the Apache License,
## Version 2.0 (the "License"); you may not use this file except
## in compliance with the License.
## You may obtain a copy of the License at
##
##  http://www.apache.org/licenses/LICENSE-2.0
##
## Unless required by applicable law or agreed to in writing,
## software distributed under the License is distributed on an
## "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
## KIND, either express or implied. See the License for the
## specific language governing permissions and limitations
## under the License.

#macro(showAssociation $association)
#set ($server = $serverManager.getServer($association.serverId))
<span id="association_${association.associationId}" class="tab">${association.jobName}</span>
#end
#macro(showView $selectedView $view)
#set ($i18nTitle = "hudson.panel.${module.getName()}.${view.getView()}.title")
#if ($selectedView == $view.getView())
	#set ($classes = "tab selected")
#else
	#set ($classes = "tab")
#end
<span id="view_${view.getView()} class="${classes}">${i18n.getText($i18nTitle)}</span>
#end
#end

<div id="hudsonTabPanel">
    <p>
		#set ($i18nDescription = "hudson.panel.${module.getName()}.$!{extraDescriptionKey}description")
		${i18n.getText($i18nDescription)}
    </p>
    <!-- Views to the right, reload builds via AJAX -->
    #if ($availableViews && !$availableViews.isEmpty())
    <div id="views">${i18n.getText("common.concepts.view")}:
        #foreach ($view in $availableViews)
            #showView(${selectedView} ${view}) #if ($velocityCount < $availableTabs.size()) | #end
        #end
    </div>
    #end
    <!-- Associations to the left, reload builds via AJAX -->
    #if ($associations && !$associations.isEmpty())
    <div id="associations">${i18n.getText('hudson.panel.associations')}
    	#foreach ($association in $associations)
    		#showAssociation($association) #if ($velocityCount < $associations.size()) | #end
    	#end
    </div>
    #end
    <div id="hudsonTabPanelHtml">
        <img src="${req.ContextPath}/images/icons/wait-large.gif" class="waitingImage" />
    </div>
</div>

<script type="text/javascript">
AJS.hudson.panel.initializePanel({
	contextPath: "${req.contextPath}",
	tabClass: "tab",
	selectedTabClass: "selected",
	contentContainer: "#hudsonTabPanelHtml",
	viewsContainer: "views",
	associationsContainer: "associations",
	view: "${selectedView}",
	associationId: ${associationId},
	module: "${module.getName()}",
	objectId: ${objectId}
});
</script>